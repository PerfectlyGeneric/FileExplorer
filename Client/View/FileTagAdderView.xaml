<Window x:Class="FileExplorer.View.FileTagAdderView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:FileExplorer.ViewModel"
        mc:Ignorable="d"
        Title="Manage Tags"
        Width="350"
        SizeToContent="Height"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False"
        WindowStyle="ToolWindow"
        Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}">

    <Window.Resources>
        <SolidColorBrush x:Key="TagBackgroundBrush" Color="#666666"/>
        <SolidColorBrush x:Key="TagTextBrush" Color="White"/>
        <SolidColorBrush x:Key="BorderBrush" Color="#ABADB3"/>

        <Style x:Key="TagChipButtonStyle" TargetType="Button">
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="0,0,5,5"/>
            <Setter Property="Background" Value="{StaticResource TagBackgroundBrush}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="12" 
                                Padding="10,4">
                            <StackPanel Orientation="Horizontal">
                                <ContentPresenter VerticalAlignment="Center" 
                                                  TextBlock.Foreground="{StaticResource TagTextBrush}"
                                                  TextBlock.FontWeight="SemiBold"
                                                  TextBlock.FontSize="11"/>
                                <TextBlock Text="×" 
                                           Margin="6,0,0,0" 
                                           Foreground="#DDDDDD" 
                                           FontSize="14" 
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Button" x:Key="DialogButtonStyle">
            <Setter Property="Height" Value="26"/>
            <Setter Property="Margin" Value="10,0,0,0"/>
            <Setter Property="Padding" Value="10,0"/>
        </Style>

        <DataTemplate x:Key="TagItemTemplate">
            <Button Style="{StaticResource TagChipButtonStyle}"
                    Content="{Binding}"
                    Command="{Binding DataContext.RemoveTagCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                    CommandParameter="{Binding}"/>
        </DataTemplate>

        <DataTemplate DataType="{x:Type vm:SingleFileMode}">
            <StackPanel Margin="0,0,0,10">
                <TextBlock Text="Editing Tags for:" FontSize="10" Foreground="Gray"/>
                <TextBlock Text="{Binding FileData.Name}" FontWeight="Bold" TextTrimming="CharacterEllipsis"/>
            </StackPanel>
        </DataTemplate>

        <DataTemplate DataType="{x:Type vm:MultipleFilesMode}">
            <StackPanel Margin="0,0,0,10">
                <TextBlock Text="Bulk Editing:" FontSize="10" Foreground="Gray"/>
                <TextBlock Text="{Binding FileCount, StringFormat='{}{0} Files Selected'}" FontWeight="Bold"/>
            </StackPanel>
        </DataTemplate>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <ContentControl Grid.Row="0" Content="{Binding CurrentPreview}" Focusable="False"/>

        <Grid Grid.Row="1" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBox Text="{Binding InputTag, UpdateSourceTrigger=PropertyChanged}"
                     VerticalContentAlignment="Center"
                     Padding="4"
                     Height="28"
                     BorderBrush="{StaticResource BorderBrush}">
                <TextBox.InputBindings>
                    <KeyBinding Key="Return" Command="{Binding AddTagCommand}"/>
                </TextBox.InputBindings>
            </TextBox>

            <Button Grid.Column="1" 
                    Content="Add" 
                    Command="{Binding AddTagCommand}"
                    Width="60" Height="28" Margin="5,0,0,0"/>
        </Grid>

        <Border Grid.Row="2" 
                BorderBrush="{StaticResource BorderBrush}" 
                BorderThickness="1" 
                CornerRadius="2" 
                Background="White" 
                MinHeight="80" MaxHeight="150"
                Margin="0,0,0,15">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding YourTags}" 
                              ItemTemplate="{StaticResource TagItemTemplate}"
                              Padding="5,5,0,0">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal"/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </ScrollViewer>
        </Border>

        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Save" 
                    Style="{StaticResource DialogButtonStyle}"
                    Width="80"
                    Command="{Binding SaveCommand}"
                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"/>

            <Button Content="Cancel" 
                    Style="{StaticResource DialogButtonStyle}"
                    Width="70"
                    IsCancel="True"
                    Command="{Binding CloseCommand}"
                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"/>
        </StackPanel>
    </Grid>
</Window>